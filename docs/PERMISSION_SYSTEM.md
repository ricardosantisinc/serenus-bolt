# üîê Sistema de Permiss√µes e N√≠veis de Acesso - Serenus SAAS

## üéØ **Vis√£o Geral**

Sistema de controle de acesso baseado em roles (RBAC) para o Serenus, garantindo seguran√ßa, privacidade de dados e segrega√ß√£o adequada de responsabilidades entre os tr√™s n√≠veis hier√°rquicos.

---

## üèóÔ∏è **Arquitetura de Permiss√µes**

### **Princ√≠pios de Seguran√ßa**
- **Princ√≠pio do Menor Privil√©gio**: Cada usu√°rio recebe apenas as permiss√µes necess√°rias para suas fun√ß√µes
- **Segrega√ß√£o de Dados**: Isolamento total de dados entre empresas
- **Auditoria Completa**: Log de todas as a√ß√µes sens√≠veis
- **Valida√ß√£o em M√∫ltiplas Camadas**: Frontend, Backend e Banco de Dados
- **Criptografia de Dados Sens√≠veis**: Prote√ß√£o de informa√ß√µes cr√≠ticas

---

## üëë **SUPERADMIN - Administrador do Sistema**

### **Escopo de Acesso**
- **Alcance**: Todo o sistema, todas as empresas
- **Limita√ß√µes**: Nenhuma (acesso administrativo completo)
- **Auditoria**: Todas as a√ß√µes s√£o logadas e monitoradas

### **Permiss√µes Detalhadas**

#### **1. Gerenciamento de Empresas**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Criar Empresa** | `companies:create` | Registro de novas empresas no sistema |
| **Visualizar Empresas** | `companies:read:all` | Acesso a dados de todas as empresas |
| **Editar Empresas** | `companies:update:all` | Modifica√ß√£o de dados empresariais |
| **Desativar Empresas** | `companies:deactivate` | Suspens√£o de contas empresariais |
| **Excluir Empresas** | `companies:delete` | Remo√ß√£o permanente (com confirma√ß√£o) |
| **Gerenciar Planos** | `subscription:manage:all` | Alterar planos de assinatura |
| **Configurar Limites** | `limits:configure:all` | Definir limites de usu√°rios, storage, etc. |

#### **2. Gerenciamento Global de Usu√°rios**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Criar Usu√°rios** | `users:create:global` | Criar usu√°rios em qualquer empresa |
| **Visualizar Usu√°rios** | `users:read:global` | Acesso a dados de todos os usu√°rios |
| **Editar Usu√°rios** | `users:update:global` | Modificar qualquer perfil de usu√°rio |
| **Alterar Roles** | `users:role:change:global` | Promover/rebaixar usu√°rios |
| **Suspender Usu√°rios** | `users:suspend:global` | Suspender contas temporariamente |
| **Excluir Usu√°rios** | `users:delete:global` | Remo√ß√£o permanente de usu√°rios |
| **Redefinir Senhas** | `users:password:reset:global` | Reset de senhas de emerg√™ncia |

#### **3. Configura√ß√µes do Sistema**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Configura√ß√µes Globais** | `system:config:all` | Par√¢metros gerais do sistema |
| **Backup e Restore** | `system:backup:manage` | Gest√£o de backups do sistema |
| **Manuten√ß√£o** | `system:maintenance` | Modo manuten√ß√£o e atualiza√ß√µes |
| **Logs do Sistema** | `system:logs:read` | Acesso a logs de auditoria |
| **Monitoramento** | `system:monitoring:read` | M√©tricas de performance e uso |
| **Integra√ß√µes** | `integrations:manage:all` | APIs e servi√ßos externos |

#### **4. Relat√≥rios e Analytics**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Relat√≥rios Globais** | `reports:global:read` | M√©tricas consolidadas do sistema |
| **Analytics Empresariais** | `analytics:companies:read` | Dados anal√≠ticos por empresa |
| **M√©tricas de Uso** | `metrics:usage:read` | Estat√≠sticas de utiliza√ß√£o |
| **Relat√≥rios Financeiros** | `reports:financial:read` | Dados de faturamento e receita |
| **Exportar Dados** | `data:export:global` | Exporta√ß√£o de dados para compliance |

#### **5. Gerenciamento de Conte√∫do**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Criar Cursos** | `content:courses:create:global` | Cria√ß√£o de conte√∫do educacional |
| **Gerenciar Biblioteca** | `content:library:manage:global` | Biblioteca global de conte√∫do |
| **Aprovar Conte√∫do** | `content:approval:global` | Aprova√ß√£o de conte√∫do criado |
| **Distribuir Conte√∫do** | `content:distribute:global` | Atribui√ß√£o massiva de conte√∫do |

---

## üëî **GERENTE - Gestor da Empresa**

### **Escopo de Acesso**
- **Alcance**: Apenas sua empresa designada
- **Limita√ß√µes**: Sem acesso a dados de outras empresas
- **Auditoria**: A√ß√µes registradas no contexto empresarial

### **Permiss√µes Detalhadas**

#### **1. Gerenciamento de Colaboradores**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Criar Colaboradores** | `users:create:company` | Adicionar novos funcion√°rios |
| **Visualizar Equipe** | `users:read:company` | Dados dos colaboradores da empresa |
| **Editar Perfis** | `users:update:company` | Modificar dados dos funcion√°rios |
| **Definir Departamentos** | `users:department:assign` | Organiza√ß√£o departamental |
| **Suspender Contas** | `users:suspend:company` | Suspens√£o tempor√°ria |
| **Gerenciar Hierarquia** | `users:hierarchy:manage` | Estrutura organizacional |

#### **2. Relat√≥rios da Equipe**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Relat√≥rios de Bem-estar** | `reports:wellness:company` | M√©tricas de sa√∫de mental da equipe |
| **Dashboard Gerencial** | `dashboard:manager:read` | Vis√£o executiva da empresa |
| **Estat√≠sticas Departamentais** | `analytics:departments:read` | Dados por departamento |
| **Relat√≥rios de Progresso** | `reports:progress:team` | Avan√ßo educacional da equipe |
| **Exportar Relat√≥rios** | `reports:export:company` | Exporta√ß√£o de dados da empresa |

#### **3. Testes DASS21 da Equipe**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Visualizar Resultados** | `dass21:results:team:read` | Resultados dos testes da equipe |
| **Acompanhar Hist√≥rico** | `dass21:history:team:read` | Evolu√ß√£o dos indicadores |
| **Configurar Periodicidade** | `dass21:schedule:company` | Definir frequ√™ncia dos testes |
| **Alertas de Risco** | `dass21:alerts:receive` | Notifica√ß√µes de casos cr√≠ticos |
| **Relat√≥rios Anal√≠ticos** | `dass21:analytics:team` | An√°lises estat√≠sticas |

#### **4. Gest√£o de Conte√∫do Educacional**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Atribuir Cursos** | `content:assign:team` | Designar conte√∫do aos colaboradores |
| **Criar Trilhas** | `content:paths:create` | Criar jornadas educacionais |
| **Acompanhar Progresso** | `content:progress:monitor` | Monitorar conclus√£o de cursos |
| **Avaliar Desempenho** | `content:performance:evaluate` | An√°lise de performance educacional |
| **Biblioteca Empresarial** | `content:library:company` | Gest√£o do acervo da empresa |

#### **5. Configura√ß√µes Empresariais**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Configurar Empresa** | `company:settings:update` | Dados e prefer√™ncias da empresa |
| **Gerenciar Notifica√ß√µes** | `notifications:company:manage` | Configurar alertas e comunica√ß√µes |
| **Definir Pol√≠ticas** | `policies:company:define` | Pol√≠ticas internas de bem-estar |

---

## üë§ **COLABORADOR - Usu√°rio Final**

### **Escopo de Acesso**
- **Alcance**: Apenas dados pessoais e conte√∫do atribu√≠do
- **Limita√ß√µes**: Sem acesso a dados de outros usu√°rios
- **Auditoria**: A√ß√µes registradas para acompanhamento pessoal

### **Permiss√µes Detalhadas**

#### **1. Gerenciamento do Perfil Pessoal**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Visualizar Perfil** | `profile:read:self` | Acesso aos pr√≥prios dados |
| **Editar Perfil** | `profile:update:self` | Modificar informa√ß√µes pessoais |
| **Alterar Senha** | `profile:password:change` | Seguran√ßa da conta |
| **Upload de Foto** | `profile:photo:upload` | Foto de perfil |
| **Prefer√™ncias** | `profile:preferences:update` | Configura√ß√µes pessoais |
| **Hist√≥rico Pessoal** | `profile:history:read` | Hist√≥rico de atividades |

#### **2. Testes DASS21 Pessoais**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Realizar Teste** | `dass21:test:take` | Execu√ß√£o do teste DASS21 |
| **Visualizar Resultados** | `dass21:results:self:read` | Pr√≥prios resultados hist√≥ricos |
| **Acompanhar Evolu√ß√£o** | `dass21:progress:self:read` | Gr√°ficos e tend√™ncias pessoais |
| **Exportar Dados** | `dass21:export:self` | Exporta√ß√£o dos pr√≥prios dados |
| **Lembretes** | `dass21:reminders:receive` | Notifica√ß√µes de teste |

#### **3. Conte√∫do Educacional**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Visualizar Cursos** | `content:courses:assigned:read` | Cursos atribu√≠dos pelo gerente |
| **Participar de Aulas** | `content:lessons:participate` | Acesso ao conte√∫do das aulas |
| **Marcar Progresso** | `content:progress:self:update` | Registrar conclus√£o de m√≥dulos |
| **Fazer Anota√ß√µes** | `content:notes:self:create` | Anota√ß√µes pessoais |
| **Favoritar Conte√∫do** | `content:favorites:self:manage` | Lista de favoritos |
| **Avalia√ß√µes** | `content:ratings:submit` | Avaliar qualidade do conte√∫do |

#### **4. Comunica√ß√£o e Suporte**
| A√ß√£o | Permiss√£o | Detalhes |
|------|-----------|----------|
| **Solicitar Ajuda** | `support:request:create` | Abrir tickets de suporte |
| **Chat com RH** | `communication:hr:chat` | Canal direto com RH |
| **Feedback An√¥nimo** | `feedback:anonymous:submit` | Enviar feedback sem identifica√ß√£o |
| **Recursos de Bem-estar** | `wellness:resources:access` | Acesso a materiais de apoio |

---

## üîí **Matriz de Seguran√ßa e Privacidade**

### **Controles de Acesso Implementados**

#### **1. Autentica√ß√£o Multi-Fator (MFA)**
| N√≠vel | Obrigat√≥rio | M√©todo |
|-------|-------------|---------|
| **SuperAdmin** | ‚úÖ Sim | TOTP + SMS |
| **Gerente** | ‚úÖ Sim | TOTP ou SMS |
| **Colaborador** | ‚ö†Ô∏è Opcional | SMS |

#### **2. Criptografia de Dados**
| Tipo de Dado | Em Repouso | Em Tr√¢nsito | Chave |
|--------------|------------|-------------|-------|
| **Dados Pessoais** | AES-256 | TLS 1.3 | Company-specific |
| **Resultados DASS21** | AES-256 | TLS 1.3 | User-specific |
| **Senhas** | bcrypt | TLS 1.3 | Salt √∫nico |

#### **3. Auditoria e Compliance**
| A√ß√£o | Log Detalhado | Reten√ß√£o | Acesso |
|-------|--------------|----------|---------|
| **Login/Logout** | ‚úÖ IP, Device, Timestamp | 2 anos | SuperAdmin |
| **Mudan√ßas de Dados** | ‚úÖ Before/After, User | 7 anos | SuperAdmin, Compliance |
| **Acesso a Relat√≥rios** | ‚úÖ User, Data, Export | 2 anos | SuperAdmin |
| **Altera√ß√µes de Permiss√£o** | ‚úÖ Full Context | Permanente | SuperAdmin |

#### **4. Isolamento de Dados**
```
üè¢ Empresa A     üè¢ Empresa B     üè¢ Empresa C
‚îú‚îÄ‚îÄ üë• Usu√°rios  ‚îú‚îÄ‚îÄ üë• Usu√°rios  ‚îú‚îÄ‚îÄ üë• Usu√°rios
‚îú‚îÄ‚îÄ üìä Dados     ‚îú‚îÄ‚îÄ üìä Dados     ‚îú‚îÄ‚îÄ üìä Dados
‚îú‚îÄ‚îÄ üìö Conte√∫do  ‚îú‚îÄ‚îÄ üìö Conte√∫do  ‚îú‚îÄ‚îÄ üìö Conte√∫do
‚îî‚îÄ‚îÄ üîí Isolado   ‚îî‚îÄ‚îÄ üîí Isolado   ‚îî‚îÄ‚îÄ üîí Isolado

        ‚¨áÔ∏è Acesso Controlado ‚¨áÔ∏è
              üîß SuperAdmin
```

---

## üõ†Ô∏è **Implementa√ß√£o T√©cnica**

### **1. Row Level Security (RLS) no Supabase**
```sql
-- Exemplo: Pol√≠ticas para tabela users
CREATE POLICY "users_select_own_company" 
ON users FOR SELECT 
USING (company_id = get_user_company_id());

CREATE POLICY "superadmin_full_access" 
ON users FOR ALL 
USING (is_super_admin(auth.uid()));
```

### **2. Middleware de Autoriza√ß√£o**
```typescript
// Verifica√ß√£o de permiss√µes em tempo real
const checkPermission = (permission: string, context?: any) => {
  return userPermissions.includes(permission) && 
         validateContext(context);
};
```

### **3. Valida√ß√£o no Frontend**
```typescript
// Renderiza√ß√£o condicional baseada em permiss√µes
{hasPermission('reports:global:read') && (
  <GlobalReportsSection />
)}
```

---

## üö® **Cen√°rios de Emerg√™ncia**

### **1. Vazamento de Dados**
- **Isolamento Imediato**: Suspens√£o autom√°tica de acessos
- **Notifica√ß√£o**: Alertas em tempo real para SuperAdmins
- **Auditoria**: Log detalhado para investiga√ß√£o
- **Comunica√ß√£o**: Notifica√ß√£o √†s empresas afetadas

### **2. Acesso N√£o Autorizado**
- **Bloqueio Autom√°tico**: Conta suspensa ap√≥s tentativas falhadas
- **An√°lise de Comportamento**: IA para detectar padr√µes suspeitos
- **Escala√ß√£o**: Notifica√ß√£o imediata para SuperAdmins

### **3. Perda de Acesso de SuperAdmin**
- **Conta de Emerg√™ncia**: SuperAdmin backup pr√©-configurado
- **Processo de Recupera√ß√£o**: Verifica√ß√£o multi-etapa
- **Documenta√ß√£o**: Procedimentos claros e auditados

---

## üìã **Checklist de Compliance**

### **LGPD (Lei Geral de Prote√ß√£o de Dados)**
- ‚úÖ Consentimento expl√≠cito para coleta de dados
- ‚úÖ Direito de acesso, retifica√ß√£o e exclus√£o
- ‚úÖ Portabilidade de dados
- ‚úÖ Minimiza√ß√£o de dados coletados
- ‚úÖ Pseudonimiza√ß√£o de dados sens√≠veis

### **ISO 27001 (Seguran√ßa da Informa√ß√£o)**
- ‚úÖ Pol√≠tica de seguran√ßa documentada
- ‚úÖ Gest√£o de riscos implementada
- ‚úÖ Controles de acesso baseados em roles
- ‚úÖ Monitoramento cont√≠nuo
- ‚úÖ Resposta a incidentes estruturada

---

## üîÑ **Atualiza√ß√µes e Melhorias Futuras**

### **Vers√£o 2.0 - Planejadas**
1. **Permiss√µes Granulares**: Controle mais fino por funcionalidade
2. **Aprova√ß√£o em M√∫ltiplas Etapas**: Workflow para a√ß√µes cr√≠ticas
3. **Intelig√™ncia Artificial**: Detec√ß√£o de anomalias comportamentais
4. **Certifica√ß√µes**: SOC 2, ISO 27001 completas
5. **Zero Trust Architecture**: Verifica√ß√£o cont√≠nua de identidade

### **Integra√ß√µes Planejadas**
- **Single Sign-On (SSO)**: SAML/OAuth2
- **Active Directory**: Sincroniza√ß√£o de usu√°rios
- **Ferramentas de Compliance**: Automa√ß√£o de auditoria
- **SIEM**: Integra√ß√£o com sistemas de seguran√ßa

---

**üìù √öltima atualiza√ß√£o**: 28/06/2025  
**üë®‚Äçüíª Desenvolvido por**: Serenus Platform Team  
**üîê Vers√£o de Seguran√ßa**: 1.0.0  
**üìä Status**: Implementado e Auditado